{% extends "base.html" %}
{% block page_title %}Approval Dashboard{% endblock %}
{% block content %}
    <h2>Pending Approvals</h2>
    {% if pending_approvals %}
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Mobile</th>
                        <th>Unit</th>
                        <th>Purpose</th>
                        <th>Check-in/out  Time</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for visitor in pending_approvals %}
                        <tr>
                            <td>{{ visitor.name }}</td>
                            <td>{{ visitor.email }}</td>
                            <td>{{ visitor.mobile }}</td>
                            <td>{{ visitor.unit or 'N/A' }}</td>
                            <td>{{ visitor.purpose }}</td>
                            <td>
                                {% if visitor.status == 'approved' and visitor.check_in_time %}
                                    {{ visitor.check_in_time.strftime('%Y-%m-%d %H:%M:%S') }}
                                {% else %}
                                    Waiting for the approval
                                {% endif %}
                            </td>
                            <td>{{ visitor.status|title }}</td>
                            <td>
                                <form method="POST" action="{{ url_for('approve_visitor', visitor_id=visitor.id) }}" style="display:inline;">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <button type="submit" class="btn btn-success btn-sm" title="Approve Visitor">Approve</button>
                                </form>
                                <form method="POST" action="{{ url_for('reject_visitor', visitor_id=visitor.id) }}" style="display:inline; margin-left:6px;">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <button type="submit" class="btn btn-danger btn-sm" title="Reject Visitor">Reject</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p>No pending approvals.</p>
    {% endif %}
{% endblock %}
